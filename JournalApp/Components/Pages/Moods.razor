@page "/moods"
@using JournalApp.Models
@inject JournalApp.Data.AppDatabase Database

<h1>Mood History</h1>

@if (entries == null)
{
    <p>Loading mood history...</p>
}
else if (entries.Count == 0)
{
    <p>No mood history available.</p>
}
else
{
    <ul>
        @foreach (var entry in entries)
        {
            <li>
                <strong>@entry.EntryDate.ToShortDateString()</strong>

                <div>
                    @if (entryMoods.TryGetValue(entry.Id, out var moods) && moods.Any())
                    {
                        <span>@string.Join(", ", moods.Select(m => m.Name))</span>
                    }
                    else
                    {
                        <span>No mood recorded</span>
                    }
                </div>
            </li>
            <hr />
        }
    </ul>
}

@code {
    private List<JournalEntry>? entries;
    private Dictionary<int, List<Mood>> entryMoods = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadMoodHistory();
    }

    private async Task LoadMoodHistory()
    {
        entries = await Database.GetEntriesAsync();
        entryMoods.Clear();

        foreach (var entry in entries)
        {
            entryMoods[entry.Id] = await Database.GetMoodsForEntryAsync(entry.Id);
        }
    }
}
