@inject IJSRuntime JS

<nav class="top-nav">
    <div class="nav-left">
        <img src="images/logo.png" class="nav-logo" />
        <span class="nav-title">Journify</span>
    </div>

    <ul class="nav-links">
        <li>
            <NavLink href="/" Match="NavLinkMatch.All" class="nav-link">
                Home
            </NavLink>
        </li>

        <li>
            <NavLink href="/dashboard" class="nav-link">
                Dashboard
            </NavLink>
        </li>

        <li>
            <NavLink href="/journal" class="nav-link">
                Journal
            </NavLink>
        </li>

        <li>
            <NavLink href="/moods" class="nav-link">
                Mood
            </NavLink>
        </li>
    </ul>

    <div class="nav-right theme-toggle">
        <button type="button"
                class="theme-btn"
                title="Toggle theme"
                @onclick="ToggleTheme">
            <i class="bi @(isDarkMode ? "bi-moon-stars-fill" : "bi-sun-fill")"></i>
        </button>
    </div>
</nav>

@code {
    private bool isDarkMode;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        var theme = await JS.InvokeAsync<string>("themeManager.get");

        if (theme == "dark")
        {
            isDarkMode = true;
            await JS.InvokeVoidAsync("themeManager.apply", "dark");
        }
        else
        {
            isDarkMode = false;
            await JS.InvokeVoidAsync("themeManager.apply", "light");
        }

        StateHasChanged();
    }

    private async Task ToggleTheme()
    {
        isDarkMode = !isDarkMode;

        await JS.InvokeVoidAsync("themeManager.set", isDarkMode ? "dark" : "light");
        await JS.InvokeVoidAsync("themeManager.apply", isDarkMode ? "dark" : "light");
    }
}
