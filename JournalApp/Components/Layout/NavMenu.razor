@inject IJSRuntime JS

<nav class="top-nav">
    <div class="nav-left">
        <img src="images/logo.png" class="nav-logo" />
        <span class="nav-title">Journify</span>
    </div>
    <ul class="nav-links">
        <li>
            <NavLink href="/" Match="NavLinkMatch.All" class="nav-link">
                Home
            </NavLink>
        </li>
        <li>
            <NavLink href="/dashboard" class="nav-link">
                Dashboard
            </NavLink>
        </li>
        <li>
            <NavLink href="/journal" class="nav-link">
                Journal
            </NavLink>
        </li>
    </ul>
    <div class="nav-right theme-toggle">
        <button type="button"
                class="theme-btn"
                title="Toggle theme"
                @onclick="ToggleTheme">
            <i class="bi @(isDarkMode ? "bi-moon-stars-fill" : "bi-sun-fill")"></i>
        </button>
    </div>
</nav>

@code {
    private bool isDarkMode;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        // Load theme from Preferences
        var savedTheme = Preferences.Get("AppTheme", "light");
        isDarkMode = savedTheme == "dark";

        // Apply the theme
        await JS.InvokeVoidAsync("themeManager.apply", savedTheme);
        StateHasChanged();
    }

    private async Task ToggleTheme()
    {
        isDarkMode = !isDarkMode;
        var theme = isDarkMode ? "dark" : "light";

        // Save to Preferences (persistent across app restarts)
        Preferences.Set("AppTheme", theme);

        // Apply the theme
        await JS.InvokeVoidAsync("themeManager.apply", theme);
    }
}